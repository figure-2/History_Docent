# 데이터셋 분할 전략 (Dataset Split Strategy)

> **Summary**: 과적합(Overfitting) 방지를 위해 데이터셋을 Train/Validation/Test로 체계적으로 분할하고, 각 단계에서 적절한 세트만 사용하는 전략을 수립했습니다.

## 1. 문제점: 데이터 누수(Data Leakage) 위험

### 1.1 초기 계획의 문제
1. **임베딩 모델 선정**: 11,140개 전체 사용
2. **임베딩 모델 파인튜닝**: 같은 11,140개 사용?
3. **리트리버 평가**: 같은 11,140개 사용?
4. **리랭커 파인튜닝**: 같은 11,140개 사용?

**문제**: 같은 데이터로 선정 → 학습 → 평가를 반복하면 **과적합** 발생!

## 2. 해결 방안: 데이터셋 분할 전략

### 2.1 권장 분할 비율

```
전체 데이터셋 (11,140개)
├── Train Set (60%): 6,684개
│   └── 파인튜닝용 (학습)
├── Validation Set (20%): 2,228개
│   └── 하이퍼파라미터 튜닝, 조기 종료
└── Test Set (20%): 2,228개
    └── 최종 평가용 (한 번만 사용!)
```

### 2.2 질문 유형별 균형 유지

각 세트에서도 **keyword, context, abstract** 비율을 동일하게 유지:
- Train: 각 유형 2,228개
- Validation: 각 유형 743개
- Test: 각 유형 743개

## 3. 단계별 데이터셋 사용 전략

| 단계 | Train | Validation | Test | 비고 |
|------|-------|------------|------|------|
| 1. 임베딩 모델 선정 | 사용 안 함 | 사용 | 사용 안 함 | Validation으로 선정 |
| 2. 임베딩 파인튜닝 | 학습 | 검증 | 사용 안 함 | Train 학습, Val 평가 |
| 3. 리트리버 평가 | 사용 안 함 | 사용 | 사용 안 함 | Validation으로 평가 |
| 4. 리랭커 파인튜닝 | 학습 | 검증 | 사용 안 함 | Train 학습, Val 평가 |
| 5. 최종 평가 | 사용 안 함 | 사용 안 함 | 사용 | **한 번만 사용!** |

### 3.1 임베딩 모델 선정 (Model Selection)
- **사용 데이터**: **Validation Set (2,228개)**
- **절대 사용 금지**: Test Set

### 3.2 임베딩 모델 파인튜닝 (Fine-tuning)
- **학습 데이터**: **Train Set (6,684개)**
- **검증 데이터**: **Validation Set (2,228개)**
- **절대 사용 금지**: Test Set

### 3.3 리트리버 평가 (Retriever Evaluation)
- **평가 데이터**: **Validation Set (2,228개)**
- **절대 사용 금지**: Test Set

### 3.4 리랭커 파인튜닝 (Reranker Fine-tuning)
- **학습 데이터**: **Train Set (6,684개)**
- **검증 데이터**: **Validation Set (2,228개)**
- **절대 사용 금지**: Test Set

### 3.5 최종 평가 (Final Evaluation)
- **평가 데이터**: **Test Set (2,228개) - 한 번만 사용!**
- **사용 시점**: 모든 개발/튜닝 완료 후

## 4. 권장 워크플로우

```
1. 데이터셋 분할 (Train/Val/Test)
   ↓
2. Validation Set으로 임베딩 모델 선정
   ↓
3. Train Set으로 선택된 모델 파인튜닝
   ↓
4. Validation Set으로 리트리버 평가
   ↓
5. Train Set으로 리랭커 파인튜닝
   ↓
6. Validation Set으로 중간 평가
   ↓
7. Test Set으로 최종 평가 (한 번만!)
```

## 5. 주의사항

1. **Test Set은 절대 조기 사용 금지**
   - 모든 개발/튜닝 완료 후 최종 평가에만 사용
   - Test Set으로 모델 선택하면 안 됨!

2. **데이터 누수 방지**
   - 같은 데이터로 학습하고 평가하지 않기
   - Train Set으로 학습한 모델은 Validation/Test로 평가

3. **재현 가능성**
   - Random seed 고정
   - 분할 결과 저장 및 공유

## 6. 결론

**현재 계획대로 진행하면 과적합 발생!**

**해결책**: 데이터셋을 Train/Validation/Test로 분할하고, 각 단계에서 적절한 세트만 사용

---

**관련 파일**: `backend/06_LLM_Evaluation/`
