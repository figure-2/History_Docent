# 검색 전략 벤치마크 (Retrieval Strategy Benchmark)

> **Summary**: Vector 검색의 한계를 극복하기 위해 BM25 및 Hybrid 검색 전략을 비교 실험한 결과, **Hybrid Weighted (0.6 Vector + 0.4 BM25, OKT 적용)** 방식이 MRR 0.711로 최고 성능을 기록하여 최종 선정되었습니다.

## 1. 실험 목적

단일 검색 방식(Vector Only)의 성능 한계를 보완하기 위해 하이브리드 검색 전략을 도입하여 검색 정확도 향상.

## 2. 비교 후보군

| 전략 | 방식 | 예상 강점 |
|------|------|----------|
| **Vector Only** | BGE-m3 임베딩 기반 | 의미적 유사도 검색 |
| **BM25 Only** | 키워드 매칭 (OKT 형태소 분석) | 고유명사 검색 강함 |
| **Hybrid Weighted** | Vector 60% + BM25 40% | 두 방식의 장점 결합 |
| **Hybrid RRF** | Reciprocal Rank Fusion | 순위 기반 융합 |

## 3. 평가 결과 (Validation Set: 2,223개)

### 3.1 전체 성능 비교

| 전략 | MRR | Recall@1 | Recall@5 | Latency |
|------|-----|----------|----------|---------|
| **Hybrid Weighted** | **0.711** | **0.632** | **0.830** | 62.50ms |
| Hybrid RRF | 0.664 | 0.591 | 0.776 | 64.36ms |
| Vector Only | 0.663 | 0.576 | 0.794 | 21.61ms |
| BM25 Only | 0.628 | 0.571 | 0.711 | 37.18ms |

### 3.2 OKT 적용 효과

| 전략 | 이전 (정규식) | 현재 (OKT) | MRR 변화 |
|------|-------------|-----------|---------|
| **BM25 Only** | 0.562 | **0.628** | **+11.7%** |
| **Hybrid Weighted** | 0.699 | **0.711** | **+1.7%** |
| Hybrid RRF | 0.646 | 0.664 | +2.8% |

### 3.3 질문 유형별 성능

| 전략 | Keyword MRR | Context MRR | Abstract MRR |
|------|-------------|-------------|--------------|
| **Hybrid Weighted** | **0.808** | **0.813** | **0.512** |
| Hybrid RRF | 0.787 | 0.781 | 0.422 |
| Vector Only | 0.756 | 0.744 | 0.488 |
| BM25 Only | 0.786 | 0.791 | 0.306 |

## 4. 주요 발견

### 4.1 성공 요인
1. **OKT 형태소 분석기 효과**: BM25 성능이 11.7% 향상
2. **하이브리드 검색의 우수성**: 모든 질문 유형에서 최고 성능
3. **Vector + BM25 상호 보완**: 
   - Keyword: BM25의 키워드 매칭 강점
   - Context: Vector의 의미적 유사도 강점
   - Abstract: 두 방식 결합으로 최고 성능

### 4.2 한계점
- **Abstract 질문의 낮은 성능**: 모든 전략에서 Abstract MRR이 0.5 이하
- **Latency 증가**: Hybrid는 Vector 대비 약 2.9배 느림 (하지만 성능 향상 대비 수용 가능)

## 5. 실패 케이스 분석

### 5.1 Vector Only 실패 사례
- **Query**: "묘청과 정지상이 서경으로의 천도를 인종에게 건의했을 때..."
- **문제**: '풍수지리', '지리적 이점' 등 구체적 키워드 매칭 실패
- **원인**: 의미적 유사도만으로는 고유명사나 특정 키워드 검색에 한계

### 5.2 Abstract 질문 실패 패턴
- **원인**: 대명사 사용("그 사람", "그거"), 간접적 표현, 복수 질문 결합
- **해결 방안**: 리랭커 도입 필요

## 6. 결론

**최종 선택: Hybrid Weighted (0.6 Vector + 0.4 BM25, OKT)**

**선정 근거:**
1. **최고 성능**: MRR 0.711, Recall@1 0.632
2. **균형잡힌 성능**: 모든 질문 유형에서 우수
3. **OKT 효과**: 형태소 분석으로 BM25 성능 향상
4. **실용성**: Latency 62.50ms로 수용 가능

**성능 향상:**
- Vector Only 대비: MRR +7.3%p, Recall@1 +9.7%p
- BM25 Only 대비: MRR +13.2%p, Abstract MRR +67.3%p

---

**관련 파일**: `backend/05_Retrieval_Optimization/`
