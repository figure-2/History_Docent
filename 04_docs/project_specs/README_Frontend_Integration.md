# Frontend-Backend Integration Guide

**ì‘ì„± ì¼ì‹œ:** 2025-11-25 02:45 (KST)
**ëª©ì :** RAG ë°±ì—”ë“œì™€ Next.js í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê°€ì´ë“œ

---

## ğŸ“‹ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì ë¸Œë¼ìš°ì € â”‚  â”€â”€â”€â”€>  â”‚  Next.js Frontend â”‚  â”€â”€â”€â”€>  â”‚ FastAPI Serverâ”‚
â”‚  (í¬íŠ¸: 9002)    â”‚  <â”€â”€â”€â”€  â”‚  (Server Action)  â”‚  <â”€â”€â”€â”€  â”‚  (í¬íŠ¸: 8000) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
                                                                  â–¼
                                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                            â”‚ RAG System   â”‚
                                                            â”‚ (vLLM +      â”‚
                                                            â”‚ Retrieval)   â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ì—°ë™ ì„¤ì • ì™„ë£Œ ì‚¬í•­

### 1. ë°±ì—”ë“œ ì„¤ì • (`/home/pencilfoxs/00_new/History_Docent`)

âœ… **FastAPI ì„œë²„:** `main.py`
- í¬íŠ¸: 8000
- CORS ì„¤ì •: `localhost:9002` í—ˆìš©
- ì—”ë“œí¬ì¸íŠ¸: `POST /api/query`

âœ… **RAG ì‹œìŠ¤í…œ:** `history_docent.py`
- vLLM ì ìš© ì™„ë£Œ
- í‰ê·  ì‘ë‹µ ì†ë„: 2.28ì´ˆ

### 2. í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì • (`/home/pencilfoxs/00_new/3_Docent_frontend_1117`)

âœ… **ì„œë²„ ì•¡ì…˜:** `src/app/actions.ts`
- FastAPI ë°±ì—”ë“œ í˜¸ì¶œ ì½”ë“œ ì¶”ê°€
- íƒ€ì„ì•„ì›ƒ ì„¤ì •: 10ì´ˆ
- ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ 

âœ… **í¬íŠ¸:** 9002 (package.json í™•ì¸)

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### Step 1: ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰

```bash
cd /home/pencilfoxs/00_new/History_Docent
python3 main.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
================================================================
ğŸš€ History Docent API Server ì‹œì‘
================================================================
ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸: http://localhost:8000
ğŸ“š ë¬¸ì„œ: http://localhost:8000/docs
----------------------------------------------------------------
ğŸš€ History Docent ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
ğŸ¤– vLLM ëª¨ë¸ ë¡œë“œ ì¤‘: MLP-KTLim/llama-3-Korean-Bllossom-8B
...
âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ!
```

**ì´ˆê¸°í™” ì‹œê°„:** ì•½ 2-3ë¶„ (vLLM ëª¨ë¸ ë¡œë”©)

### Step 2: í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰

**ìƒˆ í„°ë¯¸ë„ì—ì„œ:**

```bash
cd /home/pencilfoxs/00_new/3_Docent_frontend_1117
npm run dev
```

**ì˜ˆìƒ ì¶œë ¥:**
```
  â–² Next.js 15.3.3
  - Local:        http://localhost:9002
  - Network:      http://...
```

### Step 3: ì—°ê²° í…ŒìŠ¤íŠ¸

**ë°±ì—”ë“œ API í…ŒìŠ¤íŠ¸:**
```bash
cd /home/pencilfoxs/00_new/History_Docent
python3 test_api_connection.py
```

**í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸:**
1. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:9002` ì ‘ì†
2. ì§ˆë¬¸ ì…ë ¥ í›„ "ì „ì†¡" ë²„íŠ¼ í´ë¦­
3. ë‹µë³€ì´ 2~3ì´ˆ ë‚´ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ“Š API ëª…ì„¸

### ì—”ë“œí¬ì¸íŠ¸: `POST /api/query`

**Request:**
```json
{
  "question": "ì†ê¸°ì • ì„ ìˆ˜ëŠ” ì–´ë–¤ ì˜¬ë¦¼í”½ì—ì„œ ê¸ˆë©”ë‹¬ì„ ë•„ë‚˜ìš”?",
  "location": "",
  "language": "ko",
  "historicalFigurePersona": "",
  "photoDataUri": ""
}
```

**Response:**
```json
{
  "answer": "ì†ê¸°ì • ì„ ìˆ˜ëŠ” ì œ11íšŒ ë² ë¥¼ë¦° ì˜¬ë¦¼í”½ì—ì„œ ë§ˆë¼í†¤ ê¸ˆë©”ë‹¬ì„ ë•„ìŠµë‹ˆë‹¤.",
  "sources": ["ì¶œì²˜1...", "ì¶œì²˜2...", "ì¶œì²˜3..."],
  "latency": 1.23
}
```

**ì—ëŸ¬ ì‘ë‹µ:**
```json
{
  "detail": "ì§ˆë¬¸ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."
}
```

---

## ğŸ” ë¬¸ì œ í•´ê²° (Troubleshooting)

### ë¬¸ì œ 1: CORS ì˜¤ë¥˜
**ì¦ìƒ:** ë¸Œë¼ìš°ì € ì½˜ì†”ì— `CORS policy` ì˜¤ë¥˜

**í•´ê²°:**
- `main.py`ì˜ CORS ì„¤ì • í™•ì¸ (`allow_origins`ì— `http://localhost:9002` í¬í•¨ í™•ì¸)
- ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´

### ë¬¸ì œ 2: ì—°ê²° íƒ€ì„ì•„ì›ƒ
**ì¦ìƒ:** "ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€

**í•´ê²°:**
- ë°±ì—”ë“œ ì„œë²„ê°€ ì •ìƒ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸ (`http://localhost:8000/health`)
- vLLM ëª¨ë¸ ë¡œë”©ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸ (ì„œë²„ ë¡œê·¸ í™•ì¸)

### ë¬¸ì œ 3: ëª¨ë¸ ì´ˆê¸°í™” ì˜¤ë¥˜
**ì¦ìƒ:** ì„œë²„ ì‹œì‘ ì‹œ `GPU memory` ì˜¤ë¥˜

**í•´ê²°:**
- `history_docent.py`ì˜ `gpu_memory_utilization=0.6` ì„¤ì • í™•ì¸
- ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ GPUë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸ (`nvidia-smi`)

---

## âœ… ì—°ë™ ì™„ë£Œ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ (`python3 main.py`)
- [ ] ì´ˆê¸°í™” ì™„ë£Œ ë©”ì‹œì§€ í™•ì¸
- [ ] API ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ (`test_api_connection.py`)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰ (`npm run dev`)
- [ ] ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì† ì„±ê³µ (`http://localhost:9002`)
- [ ] ì§ˆë¬¸ ì…ë ¥ í›„ ë‹µë³€ ìˆ˜ì‹  í™•ì¸
- [ ] ì‘ë‹µ ì‹œê°„ 3ì´ˆ ì´ë‚´ í™•ì¸

---

**ì‘ì„± ì™„ë£Œ:** 2025-11-25 02:45 (KST)

